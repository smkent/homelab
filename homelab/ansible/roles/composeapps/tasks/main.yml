- name: Ensure web Docker network exists
  community.docker.docker_network:
    name: web
    driver: bridge
    state: present

- name: "Ensure web repository is present"
  ansible.builtin.git:
    repo: '{{ web_repo }}'
    dest: '{{ deploy_user_home }}/homelab/compose/apps/web/build'
    version: main
    accept_hostkey: true
  environment:
    GIT_TERMINAL_PROMPT: 0

- name: "Locate host profile directory"
  ansible.builtin.stat:
    path: "{{ deploy_user_home }}/homelab/compose/hosts/{{ inventory_hostname }}"
  register: host_profile_dir

- name: "Ensure active host symlink exists"
  ansible.builtin.file:
    src: "{{ inventory_hostname }}"
    dest: "{{ deploy_user_home }}/homelab/compose/hosts/active"
    state: link
    force: yes
  when: host_profile_dir.stat.isdir | default(false)
